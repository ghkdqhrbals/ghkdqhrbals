---
layout: default
title: 35. Spring Cloud 기반 MSA 변환 시작-9(성능 비교)
parent: 📌 실시간 채팅서버 프로젝트
nav_order: 35
---

MSA 버전과 이전 모노 버전의**성능**과 **변경된 점**을 비교해보려 합니다.

일단 먼저 변경점을 아래와 같이 정리해보았어요.

# 변경된 점

| 변경점                                 | 기존                                                             | 변경                                                                                                                                                                                                                             |
|-------------------------------------|----------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Tomcat -> Netty**                 | Tomcat 을 사용하면서 max connection = 10000 을 통해 동시성 증대 및 timeout 설정 | [Netty 장점 포스팅](https://ghkdqhrbals.github.io/portfolios/docs/Java/6/) Non-blocking 에 최적화됨. 하지만 Netty 의 설정들을 Spring boot 에서 변경하기가 까다로움. yaml 파일로 configuration 할 수 있는 메소드들이 별로 없기때문. 그래서 일단 기본설정을 사용. max connection 은 default 500 으로 설정 |
| **서비스 별 RDB 분할**         | RDS 1대를 유저 서비스/채팅 서비스/고객 서비스가 사용함                              | AWS RDS 1대를 유저 서비스가 사용하고, 채팅과 고객서비스는 각각 local RDB 를 사용함                                                                                                                                                                        |
| **이벤트 트랜젝션 추가**                     | 이벤트 트랜젝션 개념이 없었음                                               | 이벤트를 하나의 트랜젝션으로 일관되도록 관리하는 테이블을 추가함. update:O, event-sourcing:X. Saga의 Orchestration 패턴!                                                                                                                                       |
| **메세지 큐 상세 설정**                     | MQ 사용을 했지만, 응답과 롤백을 받지 않았음                                     | Kafka 설정 및 [유저 관리 요청, 유저 관리 응답, 채팅유저 보상 이벤트, 고객유저 보상 이벤트] 총 4가지 토픽과 파티션 추가                                                                                                                                                     |
| **Spring-cloud configuration 추가**   | 각각의 configuration 파일을 따로 관리하였음                                 | config-server 와 rabbitmq 를 통해 git에서 설정 파일을 클론하고 이를 모든 서버가 사용할 수 있도록 함. 또한 모두 모듈화하여 통합 gradle 관리 설정                                                                                                                             |
| **Spring-cloud eureka, gateway 추가** | nginx 로 모든 서비스들의 endpoint 를 **직접** 엮어주었음                       | eureka 서버에 등록하고 gateway 는 이를 자체적으로 load-balancing 하도록 설정하였음                                                                                                                                                                    |
| **Spring-security, JWT 인증/인가 추가**   | 인증과 인가를 세션으로 관리함                                               | 세션 관리 + JWT 토큰의 payload 에 저장된 permission 정보, 유저ID 를 통해 인증과 인가를 구현함. 특히 Reactor 설정을 따로 하였음                                                                                                                                      |

# 성능비교

![img](../../../assets/img/msa/124.png)

