---
layout: default
title: CSRF 공격
parent: 기타
nav_order: 3
---

## reference
* [CSRF Demystified](https://www.gnucitizen.org/blog/csrf-demystified/)
* [Understanding CSRF](https://security.stackexchange.com/questions/138987/difference-between-xss-and-csrf)

### CSRF (Cross-Site Request Forgery)
CSRF는 피해자가 자신의 의지와는 무관하게, 공격자가 원하는 웹 요청을 실행하게 만드는 공격입니다. 이 공격은 피해자가 공격자가 만든 악성 웹사이트나 이메일에 포함된 링크를 클릭하도록 유도하는 형태로 발생합니다. 예를 들어, `evil.com` 이라는 사이트에서 버튼을 클릭하면, 사용자의 지식 없이 `example.com` 의 특정 기능을 실행하는 요청이 보내질 수 있습니다.
CSRF 공격은 피해자의 쿠키에 저장된 정보를 사용하여 `example.com` 에 요청을 보냅니다. 따라서, `example.com` 서버는 이를 정상적인 요청으로 간주합니다.

그렇다면 어떻게 해야지 공격을 예방할 수 있을까요?

#### 1. 쿠키 옵션의 `HttpOnly` 를 true 로 설정하기 - CSRF 공격 예방, XSS 공격 예방
이를 통해 HttpRequest를 통해서만 cookie 정보를 전달할 수 있습니다(`document.cookie` 명령어 제한을 통해 쿠키 접근을 제한합니다.) **하지만**, 쿠키를 JS 로 열지 못하게 막을 뿐, 쿠키정보를 그대로 전달하는 것은 가능하기 때문에 원천적인 예방법은 아닙니다.

#### 2. 쿠키 옵션의 `Secure` 를 true 로 설정하기 - CSRF 공격 예방
`Secure` 옵션은 HTTPS 에서만 쿠키정보가 전달되도록 설정하는 옵션입니다. 즉, 헤더포함 모든 부분을 암호화하여 전송한다는 것이죠. **하지만**, 마찬가지로 HTTPS 에서 쿠키정보를 그대로 전달하는 것은 가능하기 때문에 원천적인 예방법은 아닙니다.

#### 3. 쿠키 옵션의 `SameSite` 를 Lax 로 설정하기 - CSRF 공격 예방
`SameSite=Lax` 로 설정하게 된다면, Cross-Site(다른 도메인)에서 오는 `POST`, `PUT`, `DELETE`, `PATCH` 요청에 쿠키정보를 전달하지 않습니다. 예로 `evil.com` 에서 `example.com` 에 `DELETE /user` 요청을 보낸다고 가정해봅시다. 이 때, `example.com` 에서는 `SameSite=Lax` 옵션을 통해 쿠키정보를 전달하지 않습니다. 

그럼 만약 `SameSite=STRICT` 라면 어떻게 될까요? `SameSite=STRICT` 라면, Cross-Site(다른 도메인)에서 오는 **모든 요청**에 쿠키정보를 전달하지 않습니다. 뭘 하든간에 쿠키정보를 전달하지 않는 것이죠. 만약 같은 도메인으로부터의 요청이 아니라면 말이죠! 다만 사용자들이 매우 불편해할 수 있어요.

정리해보았을 때, `HttpOnly=true`, `Secure=true`, `SameSite=Lax` 로 중요한 쿠키를 관리하게 된다면 CSRF 공격을 예방할 수 있습니다!

