---
layout: default
title: 기타
parent: 기타
nav_order: 4
---

# Spring Cloud Gateway
## SSL 인증서 적용 방법
* `sudo openssl pkcs12 -export -in fullchain.pem -inkey privkey.pem -out keystore.p12 -name ttp -CAfile chain.pem -caname root`

## fastAPI def 와 async def 차이
* `def` 로 api 요청 받을 시, fastAPI 는 새로운 스레드를 생성 및 실행
* `async def` 로 api 요청 받을 시, fastAPI 는 워커 스레드 풀 내에서 실행

## 저는 왜 JWT 와 Redis Session Cluster 을 같이 썼을까요?

* 첫번째 문제점
  * Session 인증의 문제점은 동일 서버 스케일 아웃 시, 로그인한 사용자가 다른 서버로 요청을 보낼 경우, 로그인이 풀리는 문제가 발생합니다.
  * RDB CP를 계속 소모합니다. 동시접속자가 많을 수록 더 많은 RDB 연결을 소모합니다. 
* 해결책 - 토큰 기반 인증 
  * 토큰은 서버에 저장하지 않고, 클라이언트에 저장합니다. 이러면 DB Connection 을 줄일 수 있습니다.
  * 서버 스케일 아웃 시, 동일 서버에 로그인한 사용자가 다른 서버로 요청을 보내도 로그인이 풀리지 않도록 할 수 있습니다.
* 두번째 문제점
  * 토큰은 클라이언트에 저장되기 때문에, 클라이언트가 토큰을 탈취당하면, 토큰을 사용하여 인증이 가능합니다.
  * 유저가 중복으로 로그인이 가능합니다.
* 해결책 - Redis Session Cluster
  * Key 로 유저고유 식별번호를 설정한다면 중복 유저 로그인을 방지할 수 있습니다.
  * 비정상 유저 강제 로그아웃이 가능합니다.

* 이런 질문이 있을 수 있습니다
  * JWT 없이도 Redis Session Cluster 만 사용하면 되지 않나? 왜 JWT 를 굳이 추가했나요?

* JWT 를 사용하는 이유는 다음과 같습니다
  * accessToken, refreshToken 을 사용하여 refreshToken 을 Redis 에 저장한다면 accessToken 만료기간전까지는 Redis 에 접속하지 않아도 된다(하지만, accessToken 만료기간이 지나면, Redis 에 접속하여 refreshToken 을 확인해야한다).

즉, Redis Session Cluster 의 R/W 를 줄일 수 있습니다.

* **JWT 와 Redis Session Cluster 을 함께 사용하면 얻는 이점**
  * [Redis Session Cluster 이점]
    * 중복 유저 로그인 방지(만약 유저 고유넘버를 key 로 저장한다면 가능)
    * 특정 유저 강제 로그아웃 가능(유저가 비정상적인 행동 수행 시, 서버 측에서 퇴실시킬 수 있습니다)
  * [JWT 이점]
    * Redis Session Cluster 의 R/W 를 줄일 수 있습니다. 네트워크도 그만큼 작게 타겠죠?