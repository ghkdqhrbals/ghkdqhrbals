---
layout: default
title: Spring Security(WebFlux)
parent: Java-Spring
nav_order: 6
---

![img](../../../assets/img/webflux/img.png)
![img](../../../assets/img/webflux/1.png)


@EnableWebFluxSecurity를 선언해 줄 경우, 자동적으로 아래와 같은 설정으로 SecurityWebFilterChain 클래스가 구성됩니다.

```java
@Bean
public SecurityWebFilterChain springSecurityFilterChain(ServerHttpSecurity http) {
    http
         .authorizeExchange()
              .anyExchange().authenticated()
                   .and()
              .httpBasic().and()
              .formLogin();
    return http.build();
}
```

```java
@Bean
@DependsOn({"methodSecurityExpressionHandler"})
public SecurityWebFilterChain securityWebFilterChain(
        ServerHttpSecurity http,
        JwtTokenProvider jwtTokenProvider,
        ReactiveAuthenticationManager reactiveAuthenticationManager) {
    DefaultMethodSecurityExpressionHandler defaultWebSecurityExpressionHandler = this.applicationContext.getBean(DefaultMethodSecurityExpressionHandler.class);
    defaultWebSecurityExpressionHandler.setPermissionEvaluator(myPermissionEvaluator());
    return http
            .exceptionHandling(exceptionHandlingSpec -> exceptionHandlingSpec
                    .authenticationEntryPoint((exchange, ex) -> {
                        return Mono.fromRunnable(() -> {
                            exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);
                        });
                    })
                    .accessDeniedHandler((exchange, denied) -> {
                        return Mono.fromRunnable(() -> {
                            exchange.getResponse().setStatusCode(HttpStatus.FORBIDDEN);
                        });
                    }))
                            .cors().disable()
            .csrf().disable()
            .formLogin().disable()
            .httpBasic().disable()
            .authenticationManager(reactiveAuthenticationManager)
            .securityContextRepository(NoOpServerSecurityContextRepository.getInstance())
            .authorizeExchange(exchange -> exchange
                    .pathMatchers(HttpMethod.OPTIONS).permitAll()
                    .pathMatchers("/login").permitAll()
                    .anyExchange().authenticated()
            )
            .addFilterAt(new JwtTokenAuthenticationFilter(jwtTokenProvider), SecurityWebFiltersOrder.HTTP_BASIC)
            .build();
}
```

```java
@Bean
public PermissionEvaluator myPermissionEvaluator() {
    return new PermissionEvaluator() {
        @Override
        public boolean hasPermission(Authentication authentication, Object targetDomainObject, Object permission) {
            if(authentication.getAuthorities().stream()
                    .filter(grantedAuthority -> grantedAuthority.getAuthority().equals(targetDomainObject))
                    .count() > 0)
                return true;
            return false;
        }

        @Override
        public boolean hasPermission(Authentication authentication, Serializable targetId, String targetType, Object permission) {
            return false;
        }
    };
}
```